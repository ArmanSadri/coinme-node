{"version":3,"sources":["../../../src/js/slack/NotificationBuilder.js"],"names":[],"mappings":"AAAA;;;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;IAEM,mB;;;;;;;;;;;;;;;;;;gCAOM,K,EAAO;AACX,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,iBAAT,EAA4B,KAA5B,CAAP;AACH;;;;;;;;;;;6BAQI,K,EAAM;AACP,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,cAAT,EAAyB,KAAzB,CAAP;AACH;;;;;;;;;;6BAOI,K,EAAM;AACP,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,oBAAT,EAA+B,KAA/B,CAAP;AACH;;;iCAEQ,S,EAAU;AACf,oCAAc,cAAd,CAA6B,SAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,kBAAT,EAA6B,SAA7B,CAAP;AACH;;;;;;;;sCAKa;AACV,gBAAI,cAAc,KAAK,GAAL,CAAS,qBAAT,CAAlB;;AAEA,gBAAI,CAAC,WAAL,EAAkB;AACd,8BAAc,EAAd;;AAEA,qBAAK,GAAL,CAAS,qBAAT,EAAgC,WAAhC;AACH;;AAED,mBAAO,WAAP;AACH;;;;;;;;qCAKY;AACT,mBAAO,gCAAsB;AACzB,wBAAQ;AADiB,aAAtB,CAAP;AAGH;;;;;;;;oCAKW;AACR,mBAAO,KAAK,GAAL,CAAS,SAAT,CAAP;AACH;;;;;;;;iCAKQ;AACL,mBAAO,KAAK,SAAL,CAAe,KAAK,SAAL,EAAf,CAAP;AACH;;;;;;;;;kCAMS;AACN,gBAAI,QAAQ,IAAZ;;AAEA,gBAAI,MAAM,KAAK,GAAf;AACA,gBAAI,UAAU,KAAK,SAAL,EAAd;;AAEA,oCAAc,cAAd,CAA6B,MAAM,GAAnC,EAAwC,qDAAxC;;AAEA,mBAAO,mBAAQ,OAAR,GACF,IADE,CACG,YAAM;;;;;;;;;;;;;AAaR,oBAAI,iBAAiB;AACjB,yBAAK,GADY;AAEjB,4BAAQ,MAFS;AAGjB,0BAAM,OAHW;AAIjB,0BAAM;AAJW,iBAArB;;AAOA,kCAAO,IAAP,aAAsB,MAAM,IAA5B,iBAA8C,KAAK,SAAL,CAAe,OAAf,CAA9C;;AAEA,uBAAO,mBAAQ,OAAR,CAAgB,8BAAQ,cAAR,CAAhB,EACF,IADE,CACG,UAAS,KAAT,EAAgB;AAClB,sCAAO,KAAP,aAAuB,MAAM,IAA7B,2BAAyD,SAAzD;;AAEA,2BAAO,KAAP;AACH,iBALE,EAMF,KANE,CAMI,UAAS,GAAT,EAAc;AACjB,sCAAO,IAAP,aAAsB,MAAM,IAA5B,wBAAqD,SAArD;;AAEA,0BAAM,GAAN;AACH,iBAVE,CAAP;AAWH,aAlCE,CAAP;AAmCH;;;;;;;;;;;;;kCAUgB,M,EAAQ,I,EAAM;AAC3B,mBAAO,qBAAW,eAAX,CAA2B,IAA3B,CAAP;;AAEA,gBAAI,gBAAgB,KAAK,aAAzB;;AAEA,0BAAc,eAAd,CAA8B,MAA9B;;AAEA,mBAAO,mBAAQ,OAAR,CAAgB,MAAhB,EACF,IADE,CACG,UAAS,MAAT,EAAiB;AACnB,8BAAc,eAAd,CAA8B,MAA9B,EAAsC,gCAAtC;AACA,8BAAc,gBAAd,CAA+B,MAA/B,EAAuC,qCAAvC;AACA,8BAAc,cAAd,CAA6B,MAA7B,EAAqC,kCAArC;;AAEA,oBAAI,kBAAkB,mBAAtB,EAA2C;AACvC,2BAAO,MAAP;AACH;;AAED,uBAAO,IAAI,mBAAJ,CAAwB,MAAxB,CAAP;AACH,aAXE,CAAP;AAYH;;;;;;kBAGU,mB","file":"NotificationBuilder.js","sourcesContent":["'use strict';\n\nimport Promise from 'bluebird';\nimport Logger from 'winston';\nimport Preconditions from './../Preconditions';\nimport request from 'request-promise';\n\nimport CoreObject from '~/CoreObject';\nimport AbstractBuilder from './AbstractBuilder';\nimport AttachmentBuilder from './AttachmentBuilder';\nimport Ember from '~/Ember';\n\nclass NotificationBuilder extends AbstractBuilder {\n\n    /**\n     *\n     * @param {String} value\n     * @returns {NotificationBuilder}\n     */\n    channel(value) {\n        Preconditions.shouldBeString(value);\n\n        return this.set('payload.channel', value);\n    }\n\n    /**\n     *\n     *\n     * @param text\n     * @returns {NotificationBuilder}\n     */\n    text(text) {\n        Preconditions.shouldBeString(text);\n\n        return this.set('payload.text', text);\n    }\n\n    /**\n     *\n     * @param icon\n     * @returns {icon}\n     */\n    icon(icon) {\n        Preconditions.shouldBeString(icon);\n\n        return this.set('payload.icon_emoji', icon);\n    }\n\n    username(username) {\n        Preconditions.shouldBeString(username);\n\n        return this.set('payload.username', username);\n    }\n\n    /**\n     * @returns {Array}\n     */\n    attachments() {\n        let attachments = this.get('payload.attachments');\n\n        if (!attachments) {\n            attachments = [];\n            \n            this.set('payload.attachments', attachments);\n        }\n\n        return attachments;\n    }\n\n    /**\n     * @returns {AttachmentBuilder}\n     */\n    attachment() {\n        return new AttachmentBuilder({\n            parent: this\n        });\n    }\n\n    /**\n     * @returns {Object}\n     */\n    toPayload() {\n        return this.get('payload');\n    }\n\n    /**\n     * @returns {String}\n     */\n    toJson() {\n        return JSON.stringify(this.toPayload());\n    }\n\n    /**\n     *\n     * @return {Promise}\n     */\n    execute() {\n        let scope = this;\n\n        let url = this.url;\n        let payload = this.toPayload();\n\n        Preconditions.shouldBeString(scope.url, 'NotificationBuilder.execute(): url must be a string');\n\n        return Promise.resolve()\n            .then(() => {\n                //\n                // https://www.npmjs.com/package/request-promise\n                //\n                // var options = {\n                //    method: 'POST',\n                //    uri: 'http://posttestserver.com/post.php',\n                //    body: {\n                //        some: 'payload'\n                //    },\n                //    json: true // Automatically stringifies the body to JSON\n                // };\n\n                let requestOptions = {\n                    uri: url,\n                    method: 'POST',\n                    body: payload,\n                    json: true\n                };\n\n                Logger.warn(`[SLACK:${scope.name}] webhook `, JSON.stringify(payload));\n\n                return Promise.resolve(request(requestOptions))\n                    .then(function(value) {\n                        Logger.debug(`[SLACK:${scope.name}] webhook succeeded.`, arguments);\n\n                        return value;\n                    })\n                    .catch(function(err) {\n                        Logger.warn(`[SLACK:${scope.name}] webhook failed.`, arguments);\n\n                        throw err;\n                    });\n            });\n    }\n\n    /**\n     * Do not insert a Promise into this method.\n     *\n     * @param {Object|NotificationBuilder} object\n     * @param {Object|undefined} deps\n     * @param {Preconditions|undefined} deps.Preconditions\n     * @return {Promise<NotificationBuilder>}\n     */\n    static innerCast(object, deps) {\n        deps = CoreObject.toDependencyMap(deps);\n\n        let Preconditions = deps.Preconditions;\n\n        Preconditions.shouldBeDefined(object);\n\n        return Promise.resolve(object)\n            .then(function(result) {\n                Preconditions.shouldBeDefined(object, 'Casted object must be defined.');\n                Preconditions.shouldNotBeArray(object, 'Casted object must NOT be an array.');\n                Preconditions.shouldBeObject(object, 'Casted object must be an object.');\n\n                if (result instanceof NotificationBuilder) {\n                    return result;\n                }\n\n                return new NotificationBuilder(object);\n            });\n    }\n}\n\nexport default NotificationBuilder;"]}