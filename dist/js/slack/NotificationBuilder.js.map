{"version":3,"sources":["../../../src/js/slack/NotificationBuilder.js"],"names":[],"mappings":"AAAA;;;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;IAEM,mB;;;;;;;;;;;;;;;;;;gCAOM,K,EAAO;AACX,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,SAAT,EAAoB,KAApB,CAAP;AACH;;;;;;;;;;;6BAQI,K,EAAM;AACP,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,MAAT,EAAiB,KAAjB,CAAP;AACH;;;;;;;;;;6BAOI,K,EAAM;AACP,oCAAc,cAAd,CAA6B,KAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,YAAT,EAAuB,KAAvB,CAAP;AACH;;;iCAEQ,S,EAAU;AACf,oCAAc,cAAd,CAA6B,SAA7B;;AAEA,mBAAO,KAAK,GAAL,CAAS,UAAT,EAAqB,SAArB,CAAP;AACH;;;sCAEa;AACV,mBAAO,gBAAM,cAAN,CAAqB,IAArB,EAA2B,aAA3B,EAA0C,EAA1C,CAAP;AACH;;;qCAEY;AACT,mBAAO,gCAAsB,IAAtB,CAAP;AACH;;;oCAEW;AACR,mBAAO,KAAK,GAAL,CAAS,SAAT,CAAP;AACH;;;iCAEQ;AACL,mBAAO,KAAK,SAAL,CAAe,KAAK,SAAL,EAAf,CAAP;AACH;;;;;;;;;kCAMS;AACN,gBAAI,QAAQ,IAAZ;;AAEA,gBAAI,MAAM,KAAK,GAAf;AACA,gBAAI,UAAU,KAAK,SAAL,EAAd;;AAEA,oCAAc,cAAd,CAA6B,MAAM,GAAnC,EAAwC,qDAAxC;;AAEA,mBAAO,mBAAQ,OAAR,GACF,IADE,CACG,YAAM;;;;;;;;;;;;;AAcR,oBAAI,iBAAiB;AACjB,yBAAK,GADY;AAEjB,4BAAQ,MAFS;AAGjB,0BAAM,OAHW;AAIjB,0BAAM;AAJW,iBAArB;;AAOA,kCAAO,KAAP,aAAuB,MAAM,IAA7B,iBAA+C,cAA/C;;AAEA,uBAAO,mBAAQ,OAAR,CAAgB,8BAAQ,cAAR,CAAhB,EACF,IADE,CACG,UAAS,KAAT,EAAgB;AAClB,sCAAO,KAAP,aAAuB,MAAM,IAA7B,2BAAyD,SAAzD;;AAEA,2BAAO,KAAP;AACH,iBALE,EAMF,KANE,CAMI,UAAS,GAAT,EAAc;AACjB,sCAAO,IAAP,aAAsB,MAAM,IAA5B,wBAAqD,SAArD;;AAEA,0BAAM,GAAN;AACH,iBAVE,CAAP;AAWH,aAnCE,CAAP;AAoCH;;;;;;;;;;;;;kCAUgB,M,EAAQ,I,EAAM;AAC3B,mBAAO,qBAAW,eAAX,CAA2B,IAA3B,CAAP;;AAEA,gBAAI,gBAAgB,KAAK,aAAzB;;AAEA,0BAAc,eAAd,CAA8B,MAA9B;;AAEA,mBAAO,mBAAQ,OAAR,CAAgB,MAAhB,EACF,IADE,CACG,UAAS,MAAT,EAAiB;AACnB,8BAAc,eAAd,CAA8B,MAA9B,EAAsC,gCAAtC;AACA,8BAAc,gBAAd,CAA+B,MAA/B,EAAuC,qCAAvC;AACA,8BAAc,cAAd,CAA6B,MAA7B,EAAqC,kCAArC;;AAEA,oBAAI,kBAAkB,mBAAtB,EAA2C;AACvC,2BAAO,MAAP;AACH;;AAED,uBAAO,IAAI,mBAAJ,CAAwB,MAAxB,CAAP;AACH,aAXE,CAAP;AAYH;;;;;;kBAGU,mB","file":"NotificationBuilder.js","sourcesContent":["'use strict';\n\nimport Promise from 'bluebird';\nimport Logger from 'winston';\nimport Preconditions from 'preconditions';\nimport request from 'request-promise';\n\nimport CoreObject from '~/CoreObject';\nimport AbstractBuilder from './AbstractBuilder';\nimport AttachmentBuilder from './AttachmentBuilder';\nimport Ember from '~/ember';\n\nclass NotificationBuilder extends AbstractBuilder {\n\n    /**\n     *\n     * @param {String} value\n     * @returns {NotificationBuilder}\n     */\n    channel(value) {\n        Preconditions.shouldBeString(value);\n\n        return this.set('channel', value);\n    }\n\n    /**\n     *\n     *\n     * @param text\n     * @returns {NotificationBuilder}\n     */\n    text(text) {\n        Preconditions.shouldBeString(value);\n\n        return this.set('text', text);\n    }\n\n    /**\n     *\n     * @param icon\n     * @returns {icon}\n     */\n    icon(icon) {\n        Preconditions.shouldBeString(value);\n\n        return this.set('icon_emoji', icon);\n    }\n\n    username(username) {\n        Preconditions.shouldBeString(username);\n\n        return this.set('username', username);\n    }\n\n    attachments() {\n        return Ember.getWithDefault(this, 'attachments', []);\n    }\n\n    attachment() {\n        return new AttachmentBuilder(this);\n    }\n\n    toPayload() {\n        return this.get('payload');\n    }\n\n    toJson() {\n        return JSON.stringify(this.toPayload());\n    }\n\n    /**\n     *\n     * @return {Promise}\n     */\n    execute() {\n        let scope = this;\n\n        let url = this.url;\n        let payload = this.toPayload();\n\n        Preconditions.shouldBeString(scope.url, 'NotificationBuilder.execute(): url must be a string');\n\n        return Promise.resolve()\n            .then(() => {\n                //\n                // https://www.npmjs.com/package/request-promise\n                //\n                // var options = {\n                //    method: 'POST',\n                //    uri: 'http://posttestserver.com/post.php',\n                //    body: {\n                //        some: 'payload'\n                //    },\n                //    json: true // Automatically stringifies the body to JSON\n                // };\n\n\n                let requestOptions = {\n                    uri: url,\n                    method: 'POST',\n                    body: payload,\n                    json: true\n                };\n\n                Logger.debug(`[SLACK:${scope.name}] webhook `, requestOptions);\n\n                return Promise.resolve(request(requestOptions))\n                    .then(function(value) {\n                        Logger.debug(`[SLACK:${scope.name}] webhook succeeded.`, arguments);\n\n                        return value;\n                    })\n                    .catch(function(err) {\n                        Logger.warn(`[SLACK:${scope.name}] webhook failed.`, arguments);\n\n                        throw err;\n                    });\n            });\n    }\n\n    /**\n     * Do not insert a Promise into this method.\n     *\n     * @param {Object|NotificationBuilder} object\n     * @param {Object|undefined} deps\n     * @param {Preconditions|undefined} deps.Preconditions\n     * @return {Promise<NotificationBuilder>}\n     */\n    static innerCast(object, deps) {\n        deps = CoreObject.toDependencyMap(deps);\n\n        let Preconditions = deps.Preconditions;\n\n        Preconditions.shouldBeDefined(object);\n\n        return Promise.resolve(object)\n            .then(function(result) {\n                Preconditions.shouldBeDefined(object, 'Casted object must be defined.');\n                Preconditions.shouldNotBeArray(object, 'Casted object must NOT be an array.');\n                Preconditions.shouldBeObject(object, 'Casted object must be an object.');\n\n                if (result instanceof NotificationBuilder) {\n                    return result;\n                }\n\n                return new NotificationBuilder(object);\n            });\n    }\n}\n\nexport default NotificationBuilder;"]}